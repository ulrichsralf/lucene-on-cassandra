# Introduction #
This project aims to deliver a type of [Lucene](http://lucene.apache.org/) directory that stores its file in a [Cassandra](http://cassandra.apache.org/) server, which makes for a scalable and robust store for Lucene indices.

# Architecture #
In brief, the [CassandraDirectory](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java) maps the concept of a Lucene directory to a column family that belongs to a certain keyspace located in a given Cassandra server. Further, it stores each file under this directory as a row in that column family.

Specifically, its files are broken down into blocks (whose sizes are capped), where each block (see [FileBlock](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java#825)) is stored as the value of a column in the corresponding row. As per http://wiki.apache.org/cassandra/CassandraLimitations, this is the recommended approach for dealing with large objects, which Lucene files tend to be. In addition, a descriptor of the file (see [FileDescriptor](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java#455)) that outlines a map of blocks therein is stored as one of the columns in that row as well. Think of this descriptor as an inode for Cassandra-based files.

The exhaustive mapping of a [Lucene directory](http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/store/Directory.html) (file) to a Cassandra column family (row) is captured in the [ColumnOrientedDirectory](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java#1276) ([ColumnOrientedFile](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java#1360)) inner-class. Specifically, it interprets Cassandra's data model in terms of Lucene\'s, and vice verca. More importantly, these are the only two inner-classes that have a foot in both the Lucene and Cassandra camps.

All writes to a file in this directory occur through a [CassandraIndexOutput](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java#1415), which puts the data flushed from a write-behind buffer into the fitting set of blocks. By the same token, all reads from a file in this directory occur through a [CassandraIndexInput](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java#1603), which gets the data needed by a read-ahead buffer from the right set of blocks.

The last (but not the least) inner-class, [CassandraClient](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java#1739), acts as a facade over a Thrift-based Cassandra client. In short, it provides operations to get/put rows/columns in the column family and keyspace associated with this directory.

# Related Work #
Unlike [Lucandra](http://www.google.com/url?sa=t&source=web&cd=1&ved=0CBUQFjAA&url=http%3A%2F%2Fgithub.com%2Ftjake%2FLucandra&ei=YrBlTPifN4uCsQO8tM3UDQ&usg=AFQjCNHOglgFV3wDHls1uInxq0ZjP6KSoA&sig2=q8IVaeRICD9v-JO69JX9cg), which attempts to bridge the gap between Lucene and Cassandra at the document-level, the [CassandraDirectory](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java) is self-sufficient in the sense that it does not require a re-write of any other component in the Lucene stack. In other words, one may use the [CassandraDirectory](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java) in conjunction with the Lucene [IndexWriter](http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/index/IndexWriter.html) and [IndexReader](http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/index/IndexReader.html), as you would any other kind of Lucene Directory. Moreover, given the the data unit that is transferred to and from Cassandra is a large-sized block, one may expect fewer round trips, and hence better throughputs, from the [CassandraDirectory](https://code.google.com/p/lucene-on-cassandra/source/browse/trunk/src/main/java/org/apache/lucene/store/CassandraDirectory.java).

# Conclusion #
In conclusion, this directory attempts to marry the rich search-based query language of Lucene with the distributed fault-tolerant database that is Cassandra. By delegating the responsibilities of replication, durability and elasticity to the directory, we free the layers above from such non-functional concerns. Our hope is that users will choose to make their large-scale indices instantly scalable by seamlessly migrating them to this type of directory (using [Directory#copy(Directory source, Directory target)](http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/store/Directory.html#copy%28org.apache.lucene.store.Directory,%20org.apache.lucene.store.Directory,%20boolean%29)).